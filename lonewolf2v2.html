<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Henny+Penny&display=swap');
    *{ overflow-x: hidden; }
    h1,h2,h3,h4,h5,h6 ,p { margin: 0; }
    body { padding: 0; margin: 0; background: linear-gradient( 360deg, #00a1bb, #00a9a9 , #0053cf ); color: #fff; font-family: 'Poppins' , sans-serif ; }
    .header { display: flex; align-items: center; padding: 10px; background: linear-gradient( 88deg, #0008ff , #00a1bb, #00ff66fa); color: #fff; box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px; }
    .header h2 { margin: 0px 0px 0px 10px; font-family: "Henny Penny", serif; color: e7e7e7; }
    .header img { border-radius: 125px; }
    .details { margin: 0px 0px 0px 15px; }
    .tournament-card { padding: 20px; }
    .tournament-card img { width: 110px; border-radius: 8px; max-width: 110px; }
    .disco-card { display: flex; flex-direction: row; align-items: center; }
    .join-btn { padding: 5px; width: 110px; border: none; color: #fff; background: linear-gradient(45deg, transparent, black); font-family: 'Poppins' , sans-serif; }
    #loader { align-items: center; justify-content: center; height: 80vh; }
</style>
<link rel="stylesheet" type="text/css" href="loader.css">
<div class="header">
    <img src="https://i.ibb.co/Cb91MJ9/icon.jpg" style="width: 40px;">
    <h2>Sniper eSports</h2>
</div>
<div class="tournament-grid" id="tournamentContainer"></div>
<div id="loader" style="display: none;">
    <div class="loader"></div>
</div>
<script>
    const DEPLOY_CODE = 'AKfycbytS2C_OolD_jy1zQULz750uch50ReusUcO01K_qjhxDU4yfLf2-cTXzmQuD6u3Hq8A';

async function fetchTournaments() {
    document.getElementById('loader').style.display = 'flex';

    try {
        const response = await fetch(`https://script.google.com/macros/s/${DEPLOY_CODE}/exec`, {
            method: 'GET'
        });
        const data = await response.json();
        displayTournaments(data);
    } catch (error) {
        console.error('Error fetching tournaments:', error);
    } finally {
        document.getElementById('loader').style.display = 'none';
    }
}

function displayTournaments(tournaments) {
    const container = document.getElementById('tournamentContainer');
    tournaments.forEach(tournament => {
        const card = createTournamentCard(tournament);
        container.appendChild(card);
    });
}

function createTournamentCard(tournament) {
    const card = document.createElement('div');
    card.className = 'tournament-card';
    card.innerHTML = `
        <div class="disco-card">
        <img src="${tournament.image}" alt="${tournament.title}">
        <div class="details">
        <h2>${tournament.title}</h2>
        <p><b>Price:</b> ${tournament.price}</p>
        <p><b>Mode:</b> ${tournament.mode}</p>
        <p><b>Prize:</b> ${tournament.prize}</p>
        <p><b>Slots Available:</b> ${tournament.slot}</p>
        </div>
        </div>
        <button class="join-btn" id="joinBtn-${tournament.title}" onclick="handleJoin('${tournament.title}', ${tournament.slot}, '${tournament.price}', this)" ${tournament.slot <= 0 ? 'disabled' : ''}>
            ${tournament.slot <= 0 ? 'No Slots' : 'Join'}
        </button>
    `;
    return card;
}

async function handleJoin(tournamentTitle, slots, price, button) {
    if (slots <= 0) {
        alert('Sorry, no slots available!');
        return;
    }

    const confirmed = confirm('Do you want to join this tournament?');
    if (!confirmed) return;

    const username = localStorage.getItem('vishal_local');
    if (!username) {
        alert('Please log in first!');
        return;
    }

    try {
        const response = await fetch(`https://script.google.com/macros/s/${DEPLOY_CODE}/exec`, {
            method: 'POST',
            body: JSON.stringify({
                action: 'join',
                username: username,
                tournament: tournamentTitle,
                price: price
            })
        });

        const result = await response.json();
        if (result.success) {
            alert('Registration successful! Details have been sent to your email.');
            button.disabled = true;
            button.textContent = 'Joined';
            button.previousElementSibling.textContent = 'Slots Available: ' + (slots - 1);
        } else {
            alert(result.message || 'Registration failed. Please try again.');
        }
    } catch (error) {
        console.error('Error during registration:', error);
        alert('An error occurred during registration. Please try again.');
    }
}

fetchTournaments();
</script>